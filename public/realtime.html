<!DOCTYPE html>
<html>
  <head>
    <title>BLACKHOLE REAL TEST</title>
    <!-- needed for adaptive design -->
    <meta charset="utf-8"/>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsSHA/2.3.1/sha256.js"></script>
    <script src="http://10.47.43.182:3030/socket.io/socket.io.js"></script>

    <script>

      const token = () => {
        const timestamp = Math.floor(Date.now()/1000+4000)
        
        var shaObj = new jsSHA("SHA-256","TEXT");
        shaObj.setHMACKey("secret", "TEXT");
        shaObj.update(`${timestamp}`);
        var hmac = shaObj.getHMAC("B64");
        return `admin.${hmac}.${timestamp}`     
      }

      var socket = io('http://10.47.43.182:3030/',{query: {authToken: token()} });
      socket.on('error', (error) => {
        console.log('ERROR:::::::::::::::::',error)
      })  

      //socket.io.opts.query = {authToken: 'admin.ew4hJWq9iaPLceOHHUym9A3grIXxNYv8oTklIscbNRI=.1554799778'}
      socket.on('disconnect', () => console.log('disconnected'))
      socket.on('connect', () => console.log('connected'))

      //socket.options.query = {authToken: 'admin.oy4LcA6132F1ajlv6jBOwmqBcz8xBg7D9O4JWkFSNVw=.1554734107'}
      //socket.connect()

      socket.on('find alerts',(err,data) => console.log('error:',err,data))

      socket.emit('find','alerts',{},(error,data) => {
        console.log(':::::::',error, data)
        document.body.innerHTML += `<ul>${data['alerts'].map(a => `<li>${a.annotations.summary} ${a.endsAt}</li>`).join('')}</ul>`
      })
      //socket.emit('authenticate', {
      //  strategy: 'test'
      //}, function(message, data) {
      //  console.log(message); // message will be null
      //  console.log(data); // data will be {"accessToken": "your token"}
      //  // You can now send authenticated messages to the server
      //});
    </script>
  </head>
  <body>
    Realtime Test
  </body>
</html>
